<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Video Player</title>
    <link rel="icon" href="https://i.ibb.co/N9WPySH/photo-2024-04-02-12-55-10.jpg" type="image/x-icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3/dist/plyr.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
            margin: 0;
            background: #000;
        }
        .container {
            display: flex;
            flex-direction: row;
            width: 100%;
        }
        .sidebar {
            width: 250px;
            background: #222;
            color: #fff;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .sidebar input, .sidebar select, .sidebar button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid #444;
            background: #333;
            color: #fff;
            border-radius: 4px;
        }
        .sidebar button {
            background: #069994;
            border: none;
            cursor: pointer;
        }
        .sidebar button:hover {
            background: #047f7d;
        }
        .player-container {
            flex: 1;
            padding: 10px;
        }
        .player-container #player {
            width: 100%;
            height: 100%;
        }
        .info {
            color: #fff;
            margin-bottom: 10px;
        }
        .separator {
            border-top: 1px solid #444;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <!-- Direct M3U8 input and button -->
            <input type="text" id="direct-m3u8" placeholder="Enter .m3u8 link here">
            <button onclick="playDirectM3U8()">Play Direct .m3u8</button>
            
            <!-- M3U URL input and button -->
            <input type="text" id="m3u-url" placeholder="Enter M3U URL here">
            <button onclick="loadM3UFromURL()">Load M3U from URL</button>
            
            <!-- File input and button -->
            <input type="file" id="file-input" accept=".m3u">
            <button onclick="loadChannels()">Load Channels</button>
            
            <!-- Dropdowns for group and channel selection -->
            <div class="separator"></div>
            <label for="group-select">Group:</label>
            <select id="group-select" onchange="updateChannelList()"></select>
            
            <label for="channel-select">Channel:</label>
            <select id="channel-select" onchange="playChannel()"></select>
            
            <div class="info" id="info">
                <strong>TVG ID:</strong> <span id="tvg-id">N/A</span><br>
                <strong>Group Title:</strong> <span id="group-title">N/A</span><br>
                <strong>Channel Name:</strong> <span id="channel-name">N/A</span>
            </div>
        </div>
        
        <div class="player-container">
            <video id="player" controls></video>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/plyr@3/dist/plyr.polyfilled.js"></script>
    <script>
        const player = new Plyr('#player');
        let channels = {};

        function playDirectM3U8() {
            const url = document.getElementById('direct-m3u8').value;
            player.source = {
                type: 'video',
                sources: [{ src: url, type: 'application/x-mpegURL' }]
            };
        }

        function loadM3UFromURL() {
            const url = document.getElementById('m3u-url').value;
            fetch(url)
                .then(response => response.text())
                .then(data => parseM3U(data))
                .catch(error => console.error('Error loading M3U:', error));
        }

        function loadChannels() {
            const fileInput = document.getElementById('file-input');
            if (fileInput.files.length === 0) {
                alert('Please select a file.');
                return;
            }
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = event.target.result;
                parseM3U(data);
            };
            reader.readAsText(file);
        }

        function parseM3U(data) {
            const lines = data.split('\n');
            channels = {};
            const groupSelect = document.getElementById('group-select');
            const channelSelect = document.getElementById('channel-select');
            groupSelect.innerHTML = '';
            channelSelect.innerHTML = '';

            lines.forEach(line => {
                if (line.startsWith('#EXTINF:')) {
                    const [info, url] = line.split(',');
                    const details = info.split(' ').filter(Boolean);
                    const channel = {
                        name: details.slice(1).join(' '),
                        url: url.trim(),
                        groupTitle: details[0].split(':')[1].trim(),
                        tvgId: details[2]?.split('=')[1].trim(),
                        logo: details[3]?.split('=')[1].trim()
                    };

                    if (!channels[channel.groupTitle]) {
                        channels[channel.groupTitle] = [];
                    }
                    channels[channel.groupTitle].push(channel);
                }
            });

            Object.keys(channels).forEach(groupTitle => {
                const option = document.createElement('option');
                option.value = groupTitle;
                option.textContent = groupTitle;
                groupSelect.appendChild(option);
            });

            updateChannelList();
        }

        function updateChannelList() {
            const groupSelect = document.getElementById('group-select');
            const channelSelect = document.getElementById('channel-select');
            const selectedGroup = groupSelect.value;
            channelSelect.innerHTML = '';

            if (channels[selectedGroup]) {
                channels[selectedGroup].forEach(channel => {
                    const option = document.createElement('option');
                    option.value = channel.url;
                    option.textContent = channel.name;
                    channelSelect.appendChild(option);
                });
            }
            displayChannelInfo({});
        }

        function playChannel() {
            const channelSelect = document.getElementById('channel-select');
            const selectedChannel = channels[document.getElementById('group-select').value]
                .find(channel => channel.url === channelSelect.value);

            if (selectedChannel) {
                player.source = {
                    type: 'video',
                    sources: [{ src: selectedChannel.url, type: 'application/x-mpegURL' }]
                };
                displayChannelInfo(selectedChannel);
            }
        }

        function displayChannelInfo(channel) {
            document.getElementById('tvg-id').textContent = channel.tvgId || 'N/A';
            document.getElementById('group-title').textContent = channel.groupTitle || 'N/A';
            document.getElementById('channel-name').textContent = channel.name || 'N/A';
        }
    </script>
</body>
</html>
