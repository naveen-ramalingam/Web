<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video Player</title>
    <link rel="icon" href="https://i.ibb.co/N9WPySH/photo-2024-04-02-12-55-10.jpg" type="image/x-icon">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Live streaming with Flowplayer" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://releases.flowplayer.org/7.2.7/skin/skin.css">
    <style>
        body {
            display: flex;
            margin: 0;
            height: 100vh;
            font-family: Arial, sans-serif;
        }
        .container {
            display: flex;
            flex-direction: row;
            width: 100%;
            height: 100%;
        }
        .left-panel {
            width: 300px;
            background: #f4f4f4;
            padding: 10px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        .left-panel input,
        .left-panel button,
        .left-panel select {
            display: block;
            width: 100%;
            margin-bottom: 0.2in;
        }
        .left-panel select {
            margin-bottom: 0;
        }
        .separator {
            border-top: 1px solid #ccc;
            margin: 10px 0;
        }
        .player-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .player-info {
            margin-bottom: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <input id="directM3U8Input" type="text" placeholder=".m3u8 link">
            <button id="playDirectM3U8">Play Direct .m3u8</button>

            <div class="separator"></div>
            
            <input id="m3uURLInput" type="text" placeholder="M3U URL">
            <button id="loadM3U">Load M3U from URL</button>

            <div class="separator"></div>
            
            <input id="fileInput" type="file" accept=".m3u">
            <button id="loadFile">Load Channels</button>

            <div class="separator"></div>
            
            <label for="groupSelect">Group:</label>
            <select id="groupSelect"></select>
            
            <label for="channelSelect">Channel:</label>
            <select id="channelSelect"></select>
        </div>
        
        <div class="player-container">
            <div id="player" data-swf="https://releases.flowplayer.org/7.2.7/flowplayer.swf">
                <video></video>
            </div>
            <div id="player-info" class="player-info"></div>
        </div>
    </div>

    <script src="https://releases.flowplayer.org/7.2.7/flowplayer.min.js"></script>
    <script>
        let channels = [];
        const groupSelect = document.getElementById('groupSelect');
        const channelSelect = document.getElementById('channelSelect');
        const playerInfo = document.getElementById('player-info');

        function updatePlayerInfo(channel) {
            playerInfo.innerHTML = `
                <strong>TVG ID:</strong> ${channel.tvgId || 'N/A'}<br>
                <strong>Group Title:</strong> ${channel.groupTitle || 'N/A'}<br>
                <strong>Channel Name:</strong> ${channel.name || 'N/A'}
            `;

            const channelLogo = document.createElement('img');
            if (channel.logo) {
                channelLogo.src = channel.logo;
                channelLogo.style.display = 'block';
                playerInfo.appendChild(channelLogo);
            } else {
                playerInfo.innerHTML += '<img src="" style="display:none;">'; // Placeholder for image if none available
            }
        }

        function loadStream(url) {
            flowplayer("#player", {
                playlist: [{ sources: [{ type: 'application/x-mpegURL', src: url }] }]
            });
        }

        document.getElementById('playDirectM3U8').addEventListener('click', () => {
            const url = document.getElementById('directM3U8Input').value;
            loadStream(url);
        });

        document.getElementById('loadM3U').addEventListener('click', () => {
            const url = document.getElementById('m3uURLInput').value;
            fetch(url)
                .then(response => response.text())
                .then(data => {
                    const parser = new DOMParser();
                    const m3u = parser.parseFromString(data, 'text/plain');
                    const lines = m3u.split('\n');
                    channels = [];
                    groupSelect.innerHTML = '';
                    channelSelect.innerHTML = '';
                    let currentGroup = null;
                    
                    lines.forEach(line => {
                        if (line.startsWith('#EXTINF')) {
                            const parts = line.split(',');
                            const channel = {
                                name: parts[1] || 'Unknown',
                                logo: parts[2] || '',
                                tvgId: '',
                                groupTitle: ''
                            };
                            channels.push(channel);
                            if (currentGroup && !groupSelect.querySelector(`option[value="${currentGroup}"]`)) {
                                groupSelect.add(new Option(currentGroup, currentGroup));
                            }
                            channelSelect.add(new Option(channel.name, channel.name));
                        } else if (line.startsWith('#EXTGRP')) {
                            currentGroup = line.split(':')[1] || 'Uncategorized';
                        }
                    });

                    if (currentGroup) {
                        groupSelect.add(new Option(currentGroup, currentGroup));
                    }
                });
        });

        document.getElementById('loadFile').addEventListener('change', event => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const data = e.target.result;
                    const lines = data.split('\n');
                    channels = [];
                    groupSelect.innerHTML = '';
                    channelSelect.innerHTML = '';
                    let currentGroup = null;
                    
                    lines.forEach(line => {
                        if (line.startsWith('#EXTINF')) {
                            const parts = line.split(',');
                            const channel = {
                                name: parts[1] || 'Unknown',
                                logo: parts[2] || '',
                                tvgId: '',
                                groupTitle: ''
                            };
                            channels.push(channel);
                            if (currentGroup && !groupSelect.querySelector(`option[value="${currentGroup}"]`)) {
                                groupSelect.add(new Option(currentGroup, currentGroup));
                            }
                            channelSelect.add(new Option(channel.name, channel.name));
                        } else if (line.startsWith('#EXTGRP')) {
                            currentGroup = line.split(':')[1] || 'Uncategorized';
                        }
                    });

                    if (currentGroup) {
                        groupSelect.add(new Option(currentGroup, currentGroup));
                    }
                };
                reader.readAsText(file);
            }
        });

        groupSelect.addEventListener('change', () => {
            const group = groupSelect.value;
            channelSelect.innerHTML = '';
            channels.filter(channel => channel.groupTitle === group).forEach(channel => {
                channelSelect.add(new Option(channel.name, channel.name));
            });
        });

        channelSelect.addEventListener('change', () => {
            const channelName = channelSelect.value;
            const channel = channels.find(c => c.name === channelName);
            if (channel) {
                updatePlayerInfo(channel);
                loadStream(channel.logo);  // Assuming logo URL as a placeholder for actual stream URL
            }
        });
    </script>
</body>
</html>
