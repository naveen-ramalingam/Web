<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JW Player Playlist Example</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jwplayer@latest"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
        }
        #player-container {
            flex: 1;
        }
        #left-panel {
            width: 300px;
            padding: 10px;
            background: #f4f4f4;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }
        .section {
            margin-bottom: 10px;
        }
        .section input,
        .section button,
        .section select {
            width: 100%;
            padding: 10px;
            margin-bottom: 5px;
        }
        .section div {
            border-top: 2px solid #ccc;
            margin-top: 5px;
        }
        #channel-details {
            display: none;
            margin-top: 10px;
        }
        #channel-link {
            background: orange;
            color: white;
            padding: 5px;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <div id="left-panel">
        <div class="section">
            <input type="text" id="direct-m3u8" placeholder=".m3u8 link here">
            <button onclick="loadDirectM3U8()">Play Direct .m3u8</button>
        </div>

        <div class="section">
            <input type="text" id="m3u-url" placeholder=".m3u URL here">
            <button onclick="loadM3U()">Load M3U from URL</button>
        </div>

        <div class="section">
            <input type="file" id="file-input" accept=".m3u">
            <button onclick="loadM3UFile()">Load Channels</button>
        </div>

        <div class="section">
            <select id="group-select" onchange="updateChannelSelect()">
                <option value="">Select Group</option>
            </select>
        </div>

        <div class="section">
            <select id="channel-select" onchange="updatePlayer()">
                <option value="">Select Channel</option>
            </select>
            <div class="white-line-channel-dropdown"></div>
        </div>

        <div id="channel-details">
            <img id="channel-logo" src="" alt="Channel Logo" style="width: 100px; height: auto;">
            <div id="channel-id"></div>
        </div>

        <div id="channel-link"></div>
        <div class="section" id="conditional-white-line"></div>
    </div>

    <div id="player-container"></div>

    <script>
        let channelData = {};
        let player = jwplayer("player-container");

        function parseM3U(content) {
            const lines = content.split('\n');
            let currentGroup = '';
            const channels = [];

            lines.forEach(line => {
                if (line.startsWith('#EXTINF:')) {
                    const parts = line.split(',');
                    const channelTitle = parts[1] || 'Unknown';
                    const channelUrl = lines[++i];
                    const channelInfo = {
                        title: channelTitle,
                        url: channelUrl
                    };
                    if (currentGroup) {
                        channelData[currentGroup].push(channelInfo);
                    }
                } else if (line.startsWith('#EXTGRP:')) {
                    currentGroup = line.substring(8);
                    if (!channelData[currentGroup]) {
                        channelData[currentGroup] = [];
                    }
                }
            });

            return channelData;
        }

        function updateGroupSelect(groups) {
            const groupSelect = document.getElementById('group-select');
            groupSelect.innerHTML = '<option value="">Select Group</option>';
            groups.forEach(group => {
                const option = document.createElement('option');
                option.value = group;
                option.textContent = group;
                groupSelect.appendChild(option);
            });
        }

        function updateChannelSelect() {
            const groupSelect = document.getElementById('group-select');
            const group = groupSelect.value;
            const channelSelect = document.getElementById('channel-select');
            channelSelect.innerHTML = '<option value="">Select Channel</option>';

            if (group && channelData[group]) {
                channelData[group].forEach(channel => {
                    const option = document.createElement('option');
                    option.value = channel.url;
                    option.textContent = channel.title;
                    channelSelect.appendChild(option);
                });
            }

            document.getElementById('channel-details').style.display = 'none';
            document.getElementById('channel-link').style.display = 'none';
        }

        function updatePlayer() {
            const channelSelect = document.getElementById('channel-select');
            const selectedChannel = channelSelect.options[channelSelect.selectedIndex];
            const channelUrl = selectedChannel.value;

            if (channelUrl) {
                player.load([{
                    file: channelUrl
                }]);
                document.getElementById('channel-link').textContent = channelUrl;
                document.getElementById('channel-link').style.display = 'block';
                document.getElementById('channel-details').style.display = 'block';
            } else {
                document.getElementById('channel-details').style.display = 'none';
                document.getElementById('channel-link').style.display = 'none';
            }
        }

        function loadDirectM3U8() {
            const m3u8Link = document.getElementById('direct-m3u8').value;
            if (m3u8Link) {
                player.setup({
                    file: m3u8Link,
                    width: "100%",
                    type: "hls",
                    controls: true
                });
            }
        }

        function loadM3U() {
            const m3uUrl = document.getElementById('m3u-url').value;
            if (m3uUrl) {
                fetch(m3uUrl)
                    .then(response => response.text())
                    .then(content => {
                        const groups = Object.keys(parseM3U(content));
                        updateGroupSelect(groups);
                    });
            }
        }

        function loadM3UFile() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const content = event.target.result;
                    const groups = Object.keys(parseM3U(content));
                    updateGroupSelect(groups);
                };
                reader.readAsText(file);
            }
        }
    </script>
</body>
</html>
