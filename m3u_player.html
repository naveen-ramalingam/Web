<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player with M3U Support</title>
    <link rel="icon" href="https://i.ibb.co/N9WPySH/photo-2024-04-02-12-55-10.jpg" type="image/x-icon">

    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/7.20.2/video-js.css" rel="stylesheet">
    <style>
        body {
            font-family: "Roboto", sans-serif;
            background-color: #000000;
            color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            display: flex;
            width: 80%;
            max-width: 1200px;
        }

        #player-container {
            flex: 2;
        }

        .sidebar {
            flex: 1;
            padding: 20px;
            border-left: 1px solid #ffffff;
            display: flex;
            flex-direction: column;
        }

        .input-group, .dropdown-group, .button-group {
            margin-bottom: 0.2in;
        }

        .input-group input, .button-group button {
            width: 100%;
            margin-bottom: 10px;
        }

        .dropdown-group select {
            width: 100%;
            margin-bottom: 10px;
        }

        .selected-info {
            margin-top: 20px;
            color: #069994;
        }

        .selected-info img {
            max-width: 100px;
            display: block;
            margin-bottom: 10px;
        }

        .separator {
            border-top: 1px solid #ffffff;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <!-- Input fields and buttons -->
            <div class="input-group">
                <input type="text" id="directM3U8Link" placeholder="Enter .m3u8 link here">
            </div>
            <div class="button-group">
                <button onclick="loadDirectM3U8()">Play Direct .m3u8</button>
            </div>

            <div class="separator"></div>

            <div class="input-group">
                <input type="text" id="m3uUrl" placeholder="Enter M3U URL here">
            </div>
            <div class="button-group">
                <button onclick="loadM3U()">Load M3U from URL</button>
            </div>

            <div class="separator"></div>

            <div class="input-group">
                <input type="file" id="fileInput" accept=".m3u">
            </div>
            <div class="button-group">
                <button onclick="loadFile()">Load Channels</button>
            </div>

            <div class="separator"></div>

            <!-- Dropdowns -->
            <div class="dropdown-group">
                <select id="groupSelect">
                    <option value="">Select Group</option>
                </select>
            </div>
            <div class="dropdown-group">
                <select id="channelSelect">
                    <option value="">Select Channel</option>
                </select>
            </div>

            <!-- Selected info display -->
            <div class="selected-info">
                <img id="channelLogo" src="" alt="Channel Logo">
                <div id="selectedInfo"></div>
            </div>
        </div>

        <!-- Video.js Player -->
        <div id="player-container">
            <video id="video-player" class="video-js vjs-default-skin" controls preload="auto" width="100%" height="auto">
                <source id="video-source" src="" type="application/x-mpegURL">
            </video>
        </div>
    </div>

    <!-- Video.js JS -->
    <script src="https://vjs.zencdn.net/7.20.2/video.min.js"></script>
    <script>
        const player = videojs('video-player');
        let channels = [];

        function loadDirectM3U8() {
            const url = document.getElementById('directM3U8Link').value;
            if (url) {
                player.src({ type: 'application/x-mpegURL', src: url });
                player.play();
            }
        }

        function loadM3U() {
            const url = document.getElementById('m3uUrl').value;
            if (url) {
                fetch(url)
                    .then(response => response.text())
                    .then(data => {
                        parseM3U(data);
                    })
                    .catch(error => console.error('Error fetching M3U URL:', error));
            }
        }

        function loadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    parseM3U(e.target.result);
                };
                reader.readAsText(file);
            }
        }

        function parseM3U(data) {
            const lines = data.split('\n');
            const groups = {};
            const channelOptions = [];

            lines.forEach(line => {
                if (line.startsWith('#EXTM3U') || line.startsWith('#EXTINF')) {
                    return;
                }
                if (line.startsWith('#EXTGRP')) {
                    const groupName = line.split(':')[1];
                    groups[groupName] = [];
                } else if (line.startsWith('#EXTINF')) {
                    const parts = line.split(',');
                    const channel = {
                        name: parts[1],
                        url: lines[lines.indexOf(line) + 1],
                        groupTitle: groups[parts[2]] ? parts[2] : '',
                        logo: parts[3] || ''
                    };
                    if (groups[channel.groupTitle]) {
                        groups[channel.groupTitle].push(channel);
                        channelOptions.push(channel);
                    }
                }
            });

            populateDropdowns(groups, channelOptions);
        }

        function populateDropdowns(groups, channels) {
            const groupSelect = document.getElementById('groupSelect');
            const channelSelect = document.getElementById('channelSelect');

            groupSelect.innerHTML = '<option value="">Select Group</option>';
            channelSelect.innerHTML = '<option value="">Select Channel</option>';

            for (const group in groups) {
                groupSelect.innerHTML += `<option value="${group}">${group}</option>`;
            }

            channels.forEach(channel => {
                channelSelect.innerHTML += `<option value="${channel.url}" data-group="${channel.groupTitle}" data-name="${channel.name}" data-logo="${channel.logo}">${channel.name}</option>`;
            });

            groupSelect.addEventListener('change', function() {
                const selectedGroup = this.value;
                const options = channelSelect.options;
                for (let i = 0; i < options.length; i++) {
                    const option = options[i];
                    if (option.getAttribute('data-group') === selectedGroup || selectedGroup === '') {
                        option.style.display = 'block';
                    } else {
                        option.style.display = 'none';
                    }
                }
            });

            channelSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                if (selectedOption) {
                    const url = selectedOption.value;
                    const name = selectedOption.getAttribute('data-name');
                    const logo = selectedOption.getAttribute('data-logo');
                    const group = selectedOption.getAttribute('data-group');

                    document.getElementById('selectedInfo').innerHTML = `
                        <strong>TVG ID:</strong> ${selectedOption.getAttribute('data-tvg-id') || 'N/A'}<br>
                        <strong>Group Title:</strong> ${group || 'N/A'}<br>
                        <strong>Channel Name:</strong> ${name || 'N/A'}
                    `;

                    const channelLogo = document.getElementById('channelLogo');
                    if (logo) {
                        channelLogo.src = logo;
                        channelLogo.style.display = 'block';
                    } else {
                        channelLogo.style.display = 'none';
                    }

                    player.src({ type: 'application/x-mpegURL', src: url });
                    player.play();
                }
            });
        }
    </script>
</body>
</html>
