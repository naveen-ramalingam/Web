<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3U Playlist Player</title>
</head>
<body>
    <h1>M3U Playlist Player</h1>
    <form id="m3uForm">
        <label for="m3uFile">Upload M3U File:</label>
        <input type="file" id="m3uFile" name="m3uFile" accept=".m3u" required>
        <button type="submit">Load Playlist</button>
    </form>
    <audio id="audioPlayer" controls>
        Your browser does not support the audio element.
    </audio>
    <div id="playlist">
        <h2>Playlist</h2>
        <ul id="playlistItems"></ul>
    </div>

    <script>
        const form = document.getElementById('m3uForm');
        const audioPlayer = document.getElementById('audioPlayer');
        const playlistItems = document.getElementById('playlistItems');
        let playlist = [];
        let currentTrackIndex = 0;

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            const fileInput = document.getElementById('m3uFile');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const contents = e.target.result;
                    parseM3U(contents);
                    loadTrack(currentTrackIndex);
                };
                reader.readAsText(file);
            }
        });

        function parseM3U(contents) {
            const lines = contents.split('\n');
            playlist = lines.filter(line => line && !line.startsWith('#'));
            renderPlaylist();
        }

        function loadTrack(index) {
            if (index >= 0 && index < playlist.length) {
                audioPlayer.src = playlist[index];
                audioPlayer.play();
                highlightCurrentTrack();
            }
        }

        function renderPlaylist() {
            playlistItems.innerHTML = '';
            playlist.forEach((track, index) => {
                const li = document.createElement('li');
                li.textContent = `Track ${index + 1}: ${track}`;
                li.addEventListener('click', () => {
                    currentTrackIndex = index;
                    loadTrack(currentTrackIndex);
                });
                playlistItems.appendChild(li);
            });
        }

        function highlightCurrentTrack() {
            const items = playlistItems.querySelectorAll('li');
            items.forEach((item, index) => {
                item.style.fontWeight = index === currentTrackIndex ? 'bold' : 'normal';
            });
        }

        audioPlayer.addEventListener('ended', () => {
            currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
            loadTrack(currentTrackIndex);
        });
    </script>
</body>
</html>
